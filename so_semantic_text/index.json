{% set p_use_pipelines = (use_pipelines | default(false) ) %}

{
  "settings": {
    {# non-serverless-index-settings-marker-start #}{%- if build_flavor != "serverless" or serverless_operator == true -%}
    "index.number_of_shards": {{number_of_shards | default(5)}},
    "index.number_of_replicas": {{number_of_replicas | default(0)}},
    "index.requests.cache.enable": false
    {%- endif -%}{# non-serverless-index-settings-marker-end #}
  },
  "mappings": {
    "dynamic": "strict",
    "properties": {
      "user": {
        "type": "keyword"
      },
      "creationDate": {
        "type": "date"
      },
      "title": {
        {% if not p_use_pipelines %}
        "copy_to": ["title_semantic"],
        {% endif %}
        "type": "text"
      },
      "questionId": {
        "type": "keyword"
      },
      "answerId": {
        "type": "keyword"
      },
      "acceptedAnswerId": {
        "type": "keyword"
      },
      "tags": {
        "type": "keyword"
      },
      "body": {
        {% if not p_use_pipelines %}
        "copy_to": ["body_semantic"],
        {% endif %}
        "type": "text"
      },
      "type": {
        "type": "keyword"
      },
      {% if p_use_pipelines %}
      "ml": {
         "properties": {
            "title_embedding": {
              "properties": {
                "tokens": {
                    "type": "sparse_vector"
                },
                "is_truncated": {
                  "type": "boolean"
                }
              }
            },
            "body_embedding": {
              "properties": {
                "tokens": {
                    "type": "sparse_vector"
                },
                "is_truncated": {
                  "type": "boolean"
                }
              }
            },
            "error_information": {
              "type": "keyword"
            }
         }
      }
      {% else %}
      "title_semantic": {
        "type": "semantic_text",
        "inference_id": "my-inference-id-model"
      },
      "body_semantic": {
        "type": "semantic_text",
        "inference_id": "my-inference-id-model"
      }
      {% endif %}
    }
  }
}
