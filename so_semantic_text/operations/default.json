    {
      "name": "index-append",
      "operation-type": "bulk",
      "indices": "so-semantic-text",
      "bulk-size": {{bulk_size | default(10)}},
      {% if p_use_pipelines %}
      "pipeline": "elser-v2-ingest",
      {% endif %}
      "ingest-percentage": {{ingest_percentage | default(100)}}
    },
    {
      "name": "create-inference-service",
      "operation-type": "raw-request",
      "path": "/_inference/{{p_task_type}}/my-inference-id-model",
      "method": "PUT",
      "body": {
        "service": "{{p_inference_service}}",
        "service_settings": {
          "model_id": "{{p_inference_model_id}}",
          "num_allocations": {{ num_allocations | default(1) | int }},
          "num_threads": {{ num_threads | default(1) | int }}
        },
        "task_settings": {}
      },
      "request-timeout": 30000,
      "include-in-reporting": false
    },
    {
      "name": "delete-inference-service",
      "operation-type": "raw-request",
      "path": "/_inference/sparse_embedding/my-inference-id-model",
      "method": "DELETE",
      "include-in-reporting": false,
      "ignore": 404
    },
    {
      "name": "setup-elser-pipeline",
      "operation-type": "put-pipeline",
      "id": "elser-v2-ingest",
      "body": {
        "description": "Pipes documents to ELSER",
        "processors": [
          {
            "inference": {
              "model_id": "my-inference-id-model",
              "input_output": [
                {
                  "input_field": "title",
                  "output_field": "ml.title_embedding.tokens"
                }
                {% if p_calculate_body_vector %}
                ,
                {
                  "input_field": "body",
                  "output_field": "ml.body_embedding.tokens"
                }
                {% endif %}
              ],
              "ignore_missing": true
            }
          }
        ],
        "on_failure": [
          {
            "set": {
              "field": "_index",
              {% raw %}
              "description": "Record error information",
              "field": "ml.error_information",
              "value": "Processor {{ _ingest.on_failure_processor_type }} with tag {{ _ingest.on_failure_processor_tag }} in pipeline {{ _ingest.on_failure_pipeline }} failed with message {{ _ingest.on_failure_message }}"
              {% endraw %}
            }
          }
        ]
      }
    },
    {
      "name": "delete-elser-pipeline",
      "operation-type": "raw-request",
      "path": "/_ingest/pipeline/elser-v2-ingest",
      "method": "DELETE",
      "include-in-reporting": false,
      "ignore": 404
    },
    {
      "name": "semantic-search",
      "operation-type": "search",
      "param-source": "semantic-search",
      "size": {{ semantic_search_page_size | default(20) | int }},
      "use_pipelines": {{ p_use_pipelines | lower }},
      "model_id": "{{ p_inference_model_id }}"
    }
